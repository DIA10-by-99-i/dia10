<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>DIA-10 | Metrics Dashboard</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800;900&display=swap" rel="stylesheet">
<meta name="theme-color" content="#0a1430">
<!-- Charts + Excel -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/chart.js/4.4.3/chart.umd.min.js" defer></script>
<script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js" defer></script>

<style>
:root{
  --bg:#0a1430; --panel:#0d1a3a; --panel2:#0a1734; --ink:#f3f7ff;
  --muted:#b9c7da; --blue:#1b6fff; --cyan:#74c7ff; --line:#1c2b55;
  --ok:#11d09a; --warn:#ffcf4a; --bad:#ff6b7a; --shadow:0 10px 28px rgba(0,0,0,.35)
}
*{box-sizing:border-box}
html,body{margin:0;background:var(--bg);color:var(--ink);font:400 16px/1.55 Inter,system-ui,sans-serif}
a{color:var(--cyan);text-decoration:none}
a:hover{color:#d7eeff}
header{position:sticky;top:0;z-index:20;backdrop-filter:blur(8px);
  background:linear-gradient(180deg,rgba(10,20,48,.85),rgba(10,20,48,.55));border-bottom:1px solid var(--line)}
.nav{max-width:1200px;margin:auto;padding:12px 18px;display:flex;align-items:center;gap:12px}
.brand{display:flex;align-items:center;gap:12px;font-weight:900;letter-spacing:.3px}
.logo{width:40px;height:40px;border-radius:10px;display:grid;place-items:center;position:relative;
  background:radial-gradient(110% 110% at 50% 30%, rgba(27,111,255,.30), transparent 60%);border:1px solid #2a3b5f}
.logo svg{width:26px;height:26px;display:block;filter:drop-shadow(0 1px 2px rgba(0,0,0,.4))}
.logo::after{content:"";position:absolute;inset:-8px;border-radius:16px;animation:pulse 3.2s ease-in-out infinite;box-shadow:0 0 0 0 rgba(116,199,255,.18)}
@keyframes pulse{0%{box-shadow:0 0 0 0 rgba(116,199,255,.18)}70%{box-shadow:0 0 0 18px rgba(116,199,255,0)}100%{box-shadow:0 0 0 0 rgba(116,199,255,0)}}
.spacer{flex:1}
.langs{display:flex;gap:8px}
.langs button{background:#0a1d44;color:var(--ink);border:1px solid rgba(255,255,255,.12);padding:8px 12px;border-radius:10px;font-weight:700;cursor:pointer}
.langs button.active{border-color:#74c7ff;box-shadow:0 0 0 1px rgba(116,199,255,.4) inset}
.btn{display:inline-flex;align-items:center;gap:8px;padding:10px 14px;border:1px solid #25407a;border-radius:12px;background:#0e214a;color:var(--ink);cursor:pointer}
.btn.cta{background:linear-gradient(90deg,#1b6fff,#74c7ff);border:none;color:#07121f;font-weight:800}
.wrap{max-width:1200px;margin:22px auto;padding:0 18px}
.hero{background:linear-gradient(180deg,#0d1a3a,#0b1732);border:1px solid var(--line);border-radius:18px;padding:18px;box-shadow:var(--shadow)}
h1{margin:.2em 0 .4em;font-size:clamp(26px,4vw,40px)}
.muted{color:var(--muted)}
.grid{display:grid;gap:16px}
@media(min-width:980px){.cols-2{grid-template-columns:1.15fr .85fr}}
.card{background:linear-gradient(180deg,var(--panel),var(--panel2));border:1px solid var(--line);border-radius:16px;padding:16px;box-shadow:var(--shadow)}
.card h3{margin:0 0 8px}
.row{display:flex;flex-wrap:wrap;gap:8px;align-items:center}
.input{display:grid;gap:6px}
label{font-weight:600}
input[type="number"],input[type="text"],select,textarea{
  background:#0a1d44;color:var(--ink);border:1px solid rgba(255,255,255,.12);
  border-radius:10px;padding:10px 12px;outline:none
}
.small{font-size:12px;color:var(--muted)}
.kpis{display:grid;gap:12px}
@media(min-width:600px){.kpis{grid-template-columns:repeat(2,1fr)}}
.kpi{background:#0a1d44;border:1px solid rgba(255,255,255,.12);border-radius:12px;padding:12px}
.kpi .lab{font-size:12px;color:#b2c3df}
.kpi .val{font-size:24px;font-weight:900;word-break:break-word}
.grid3{display:grid;gap:12px}
@media(min-width:800px){.grid3{grid-template-columns:repeat(3,1fr)}}
.flex{display:flex;gap:8px;align-items:center}
.range-wrap{display:flex;gap:8px;align-items:center}
input[type="range"]{width:100%}
.table{width:100%;border-collapse:separate;border-spacing:0;border:1px solid var(--line);border-radius:12px;overflow:hidden}
.table th,.table td{padding:10px;border-bottom:1px solid var(--line);text-align:left}
.table th{background:#0b1936}
.actions{display:flex;gap:10px;flex-wrap:wrap}
footer{margin:22px 0 26px;text-align:center;color:#8ea2c6;font-size:14px}

/* Print (PDF) */
@media print{
  header,.langs,.actions .btn:not(.print), .no-print{display:none!important}
  body{background:#fff;color:#000}
  .card,.hero{box-shadow:none;border:1px solid #ddd}
}
</style>
</head>
<body>
<header>
  <div class="nav">
    <div class="brand">
      <div class="logo" aria-hidden="true">
        <svg viewBox="0 0 24 24" fill="none" stroke="#ffffff" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
          <path d="M3 9l9-6 9 6-9 12-9-12zM12 3v18M3 9h18M7 9l5 12m5-12l-5 12"/>
        </svg>
      </div>
      <div>DIA-10</div>
    </div>
    <div class="spacer"></div>
    <a class="btn" id="visitSite" href="https://99-i.com/dia10/" target="_blank" rel="noopener">Visit website</a>
    <div class="langs">
      <button class="langbtn active" data-lang="en">EN</button>
      <button class="langbtn" data-lang="de">DE</button>
      <button class="langbtn" data-lang="ro">RO</button>
    </div>
  </div>
</header>

<section class="wrap">
  <div class="hero">
    <h1 data-i18n="title">DIA-10 Metrics Dashboard</h1>
    <div class="row">
      <div class="muted" data-i18n="subtitle">Enter your current figures. We’ll compute MRR/GMV, paying users, retention, funding ticket & use of proceeds.</div>
    </div>
  </div>

  <div class="grid cols-2" style="margin-top:12px">
    <!-- LEFT: Inputs -->
    <div class="card">
      <h3 data-i18n="inputs">Inputs</h3>
      <div class="grid" style="gap:14px">

        <div class="input">
          <label for="revMode" data-i18n="revMode">Revenue mode</label>
          <select id="revMode">
            <option value="sub" data-i18n="revSub">Subscriptions (MRR)</option>
            <option value="one" data-i18n="revOne">One-time sales (30-Day GMV)</option>
          </select>
          <div class="small" data-i18n="revHelp">Choose your model. We compute the right headline metric.</div>
        </div>

        <div id="subBlock" class="grid3">
          <div class="input">
            <label for="subs" data-i18n="subs">Active subscriptions</label>
            <input type="number" id="subs" min="0" step="1" value="0">
          </div>
          <div class="input">
            <label for="avgPrice" data-i18n="avgPrice">Avg monthly price (€)</label>
            <input type="number" id="avgPrice" min="0" step="0.01" value="0">
          </div>
          <div class="input">
            <label for="mrr" data-i18n="mrr">MRR (€) (auto)</label>
            <input type="number" id="mrr" min="0" step="0.01" value="0" readonly>
          </div>
        </div>

        <div id="oneBlock" class="grid3" style="display:none">
          <div class="input">
            <label for="orders" data-i18n="orders">Orders (last 30d)</label>
            <input type="number" id="orders" min="0" step="1" value="0">
          </div>
          <div class="input">
            <label for="avgTicket" data-i18n="avgTicket">Avg ticket (€)</label>
            <input type="number" id="avgTicket" min="0" step="0.01" value="0">
          </div>
          <div class="input">
            <label for="gmv" data-i18n="gmv">30-Day GMV (€) (auto)</label>
            <input type="number" id="gmv" min="0" step="0.01" value="0" readonly>
          </div>
        </div>

        <div class="grid3">
          <div class="input">
            <label for="payingL30" data-i18n="payingL30"># Paying (last 30d)</label>
            <input type="number" id="payingL30" min="0" step="1" value="0">
          </div>
          <div class="input">
            <label for="payingAll" data-i18n="payingAll"># Paying (all-time)</label>
            <input type="number" id="payingAll" min="0" step="1" value="0">
          </div>
          <div class="input">
            <label for="region" data-i18n="region">Region flag</label>
            <select id="region">
              <option value="eu">EU (no US offering)</option>
              <option value="global">Global (excl. restricted)</option>
            </select>
          </div>
        </div>

        <div class="grid3">
          <div class="input">
            <label for="cohort" data-i18n="cohort">Cohort size (week 0)</label>
            <input type="number" id="cohort" min="0" step="1" value="0">
          </div>
          <div class="input">
            <label for="retained" data-i18n="retained">Retained at week 4</label>
            <input type="number" id="retained" min="0" step="1" value="0">
          </div>
          <div class="input">
            <label for="retention" data-i18n="retention">4-Week Retention % (auto)</label>
            <input type="number" id="retention" min="0" max="100" step="0.1" value="0" readonly>
          </div>
        </div>

        <div class="grid3">
          <div class="input">
            <label for="burn" data-i18n="burn">Monthly burn (€)</label>
            <input type="number" id="burn" min="0" step="100" value="18000">
          </div>
          <div class="input">
            <label for="runway" data-i18n="runway">Target runway (months)</label>
            <input type="number" id="runway" min="6" max="24" step="1" value="18">
          </div>
          <div class="input">
            <label for="buffer" data-i18n="buffer">Buffer %</label>
            <input type="number" id="buffer" min="0" max="50" step="1" value="10">
          </div>
        </div>

        <div class="card" style="background:#0a1d44">
          <div class="row" style="justify-content:space-between;align-items:center">
            <b data-i18n="uop">Use of Proceeds</b>
            <span class="small" id="uopTotal">100%</span>
          </div>
          <div class="grid">
            <div class="range-wrap">
              <label style="width:160px" data-i18n="uopProd">Product</label>
              <input type="range" id="uopProd" min="0" max="100" value="45">
              <input type="number" id="uopProdNum" min="0" max="100" value="45" style="width:80px">
            </div>
            <div class="range-wrap">
              <label style="width:160px" data-i18n="uopOps">Compliance/Ops</label>
              <input type="range" id="uopOps" min="0" max="100" value="25">
              <input type="number" id="uopOpsNum" min="0" max="100" value="25" style="width:80px">
            </div>
            <div class="range-wrap">
              <label style="width:160px" data-i18n="uopGrowth">Growth</label>
              <input type="range" id="uopGrowth" min="0" max="100" value="30">
              <input type="number" id="uopGrowthNum" min="0" max="100" value="30" style="width:80px">
            </div>
            <div class="small" data-i18n="uopHint">Must sum to 100%.</div>
          </div>
        </div>

        <div class="grid">
          <div class="input">
            <label for="mileA" data-i18n="mileA">Milestone A (≤90d)</label>
            <input type="text" id="mileA" value="Creator-Toolkit v1 + 100 paying members">
          </div>
          <div class="input">
            <label for="mileB" data-i18n="mileB">Milestone B (≤90d)</label>
            <input type="text" id="mileB" value="500 verified certificates + wallet import">
          </div>
        </div>

        <div class="actions no-print">
          <button class="btn" id="resetBtn" data-i18n="reset">Reset</button>
          <button class="btn" id="excelBtn" data-i18n="exportX">Export Excel</button>
          <button class="btn cta print" onclick="window.print()" data-i18n="exportP">Export PDF</button>
        </div>

      </div>
    </div>

    <!-- RIGHT: Results -->
    <div class="card">
      <h3 data-i18n="results">Results</h3>

      <div class="kpis">
        <div class="kpi">
          <div class="lab" id="metricLabel">MRR (€)</div>
          <div class="val" id="metricValue">€0</div>
        </div>
        <div class="kpi">
          <div class="lab" data-i18n="kpiPaying"># Paying (L30D / All-time)</div>
          <div class="val"><span id="kPayL30">0</span> / <span id="kPayAll">0</span></div>
        </div>
        <div class="kpi">
          <div class="lab" data-i18n="kpiRet">4-Week Retention</div>
          <div class="val" id="kRet">0%</div>
        </div>
        <div class="kpi">
          <div class="lab" data-i18n="kpiTicket">Target ticket (raise)</div>
          <div class="val" id="kTicket">€0</div>
        </div>
      </div>

      <div class="card" style="margin-top:12px;background:#0a1d44">
        <canvas id="chartRev" height="140"></canvas>
      </div>

      <h3 style="margin-top:12px" data-i18n="uopTable">Use of Proceeds (amounts)</h3>
      <table class="table" id="uopTable">
        <thead><tr>
          <th data-i18n="thCat">Category</th>
          <th data-i18n="thPct">% </th>
          <th data-i18n="thAmt">Amount (€)</th>
        </tr></thead>
        <tbody>
          <tr><td data-i18n="uopProd">Product</td><td id="uopProdPct">45%</td><td id="uopProdAmt">€0</td></tr>
          <tr><td data-i18n="uopOps">Compliance/Ops</td><td id="uopOpsPct">25%</td><td id="uopOpsAmt">€0</td></tr>
          <tr><td data-i18n="uopGrowth">Growth</td><td id="uopGrowthPct">30%</td><td id="uopGrowthAmt">€0</td></tr>
        </tbody>
      </table>

      <div class="card" style="margin-top:12px">
        <b data-i18n="milestones">Next 90 days</b>
        <ul style="margin:8px 0 0 18px">
          <li id="mA">—</li>
          <li id="mB">—</li>
        </ul>
        <div class="small" id="regionNote">EU (no US offering)</div>
      </div>
    </div>
  </div>

  <footer>© <span id="y"></span> DIA-10 / MAGO SERVICE TRADE SRL</footer>
</section>

<script>
/* ---------- i18n strings ---------- */
const I18N = {
  en:{
    title:"DIA-10 Metrics Dashboard",
    subtitle:"Enter your current figures. We’ll compute MRR/GMV, paying users, retention, funding ticket & use of proceeds.",
    inputs:"Inputs", results:"Results",
    revMode:"Revenue mode", revSub:"Subscriptions (MRR)", revOne:"One-time sales (30-Day GMV)", revHelp:"Choose your model. We compute the right headline metric.",
    subs:"Active subscriptions", avgPrice:"Avg monthly price (€)", mrr:"MRR (€) (auto)",
    orders:"Orders (last 30d)", avgTicket:"Avg ticket (€)", gmv:"30-Day GMV (€) (auto)",
    payingL30:"# Paying (last 30d)", payingAll:"# Paying (all-time)", region:"Region flag",
    cohort:"Cohort size (week 0)", retained:"Retained at week 4", retention:"4-Week Retention % (auto)",
    burn:"Monthly burn (€)", runway:"Target runway (months)", buffer:"Buffer %",
    uop:"Use of Proceeds", uopProd:"Product", uopOps:"Compliance/Ops", uopGrowth:"Growth", uopHint:"Must sum to 100%.",
    mileA:"Milestone A (≤90d)", mileB:"Milestone B (≤90d)", reset:"Reset", exportX:"Export Excel", exportP:"Export PDF",
    kpiPaying:"# Paying (L30D / All-time)", kpiRet:"4-Week Retention", kpiTicket:"Target ticket (raise)",
    uopTable:"Use of Proceeds (amounts)", thCat:"Category", thPct:"%", thAmt:"Amount (€)",
    milestones:"Next 90 days"
  },
  de:{
    title:"DIA-10 Kennzahlen-Dashboard",
    subtitle:"Gib deine aktuellen Werte ein. Wir berechnen MRR/GMV, Zahlende, Retention, Funding-Ticket & Mitteleinsatz.",
    inputs:"Eingaben", results:"Ergebnisse",
    revMode:"Umsatzmodell", revSub:"Abos (MRR)", revOne:"Einmalverkäufe (30-Tage-GMV)", revHelp:"Wähle dein Modell. Wir berechnen die passende Leitkennzahl.",
    subs:"Aktive Abos", avgPrice:"Ø Monats­preis (€)", mrr:"MRR (€) (auto)",
    orders:"Bestellungen (30 Tage)", avgTicket:"Ø Warenkorb (€)", gmv:"30-Tage-GMV (€) (auto)",
    payingL30:"# Zahlende (30 Tage)", payingAll:"# Zahlende (gesamt)", region:"Region-Flag",
    cohort:"Kohorte (Woche 0)", retained:"Aktiv in Woche 4", retention:"4-Wo-Retention % (auto)",
    burn:"Monats-Burn (€)", runway:"Ziel-Runway (Monate)", buffer:"Puffer %",
    uop:"Mittelverwendung", uopProd:"Produkt", uopOps:"Compliance/Ops", uopGrowth:"Growth", uopHint:"Muss 100% ergeben.",
    mileA:"Meilenstein A (≤90T)", mileB:"Meilenstein B (≤90T)", reset:"Zurücksetzen", exportX:"Excel exportieren", exportP:"PDF exportieren",
    kpiPaying:"# Zahlende (30T / ges.)", kpiRet:"4-Wo-Retention", kpiTicket:"Ziel-Ticket (Finanzierung)",
    uopTable:"Mittelverwendung (Beträge)", thCat:"Kategorie", thPct:"%", thAmt:"Betrag (€)",
    milestones:"Nächste 90 Tage"
  },
  ro:{
    title:"DIA-10 Panou de Metrici",
    subtitle:"Introdu cifrele curente. Calculăm MRR/GMV, clienți plătitori, retenție, mărimea rundei & utilizarea fondurilor.",
    inputs:"Date de intrare", results:"Rezultate",
    revMode:"Mod venituri", revSub:"Abonamente (MRR)", revOne:"Vânzări unice (GMV 30 zile)", revHelp:"Alege modelul. Calculăm metrica principală corectă.",
    subs:"Abonamente active", avgPrice:"Preț lunar mediu (€)", mrr:"MRR (€) (auto)",
    orders:"Comenzi (ultimele 30z)", avgTicket:"Coș mediu (€)", gmv:"GMV 30 zile (€) (auto)",
    payingL30:"# Plătitori (30z)", payingAll:"# Plătitori (total)", region:"Regiune",
    cohort:"Cohortă (săpt. 0)", retained:"Activ la săpt. 4", retention:"Retenție 4 săpt. % (auto)",
    burn:"Burn lunar (€)", runway:"Runway țintă (luni)", buffer:"Buffer %",
    uop:"Utilizarea fondurilor", uopProd:"Produs", uopOps:"Compliance/Ops", uopGrowth:"Growth", uopHint:"Trebuie să fie 100%.",
    mileA:"Milestone A (≤90z)", mileB:"Milestone B (≤90z)", reset:"Reset", exportX:"Export Excel", exportP:"Export PDF",
    kpiPaying:"# Plătitori (30z / total)", kpiRet:"Retenție 4 săpt.", kpiTicket:"Mărimea rundei",
    uopTable:"Utilizarea fondurilor (sume)", thCat:"Categorie", thPct:"%", thAmt:"Sumă (€)",
    milestones:"Următoarele 90 zile"
  }
};
let LANG='en';
function t(key){ return I18N[LANG][key]||key; }
function applyLang(l){
  LANG = ['en','de','ro'].includes(l)?l:'en';
  document.documentElement.lang = LANG;
  document.querySelectorAll('[data-i18n]').forEach(el=>{
    const k = el.getAttribute('data-i18n'); if(I18N[LANG][k]) el.textContent = I18N[LANG][k];
  });
  document.getElementById('metricLabel').textContent = (revMode.value==='sub') ? (LANG==='de'?'MRR (€)':'MRR (€)') :
    (LANG==='de'?'30-Tage-GMV (€)': LANG==='ro'?'GMV 30 zile (€)':'30-Day GMV (€)');
  document.querySelectorAll('.langbtn').forEach(b=> b.classList.toggle('active', b.dataset.lang===LANG));
}
document.querySelectorAll('.langbtn').forEach(b=> b.addEventListener('click', ()=> applyLang(b.dataset.lang)));
applyLang('en');
document.getElementById('y').textContent = new Date().getFullYear();

/* ---------- Elements ---------- */
const revMode = document.getElementById('revMode');
const subs = document.getElementById('subs');
const avgPrice = document.getElementById('avgPrice');
const mrr = document.getElementById('mrr');
const orders = document.getElementById('orders');
const avgTicket = document.getElementById('avgTicket');
const gmv = document.getElementById('gmv');
const payingL30 = document.getElementById('payingL30');
const payingAll = document.getElementById('payingAll');
const cohort = document.getElementById('cohort');
const retained = document.getElementById('retained');
const retention = document.getElementById('retention');
const burn = document.getElementById('burn');
const runway = document.getElementById('runway');
const buffer = document.getElementById('buffer');
const uopProd = document.getElementById('uopProd'), uopOps = document.getElementById('uopOps'), uopGrowth = document.getElementById('uopGrowth');
const uopProdNum = document.getElementById('uopProdNum'), uopOpsNum = document.getElementById('uopOpsNum'), uopGrowthNum = document.getElementById('uopGrowthNum');
const uopTotal = document.getElementById('uopTotal');
const subBlock = document.getElementById('subBlock');
const oneBlock = document.getElementById('oneBlock');
const metricLabel = document.getElementById('metricLabel');
const metricValue = document.getElementById('metricValue');
const kPayL30 = document.getElementById('kPayL30');
const kPayAll = document.getElementById('kPayAll');
const kRet = document.getElementById('kRet');
const kTicket = document.getElementById('kTicket');
const uopProdPct = document.getElementById('uopProdPct'), uopOpsPct = document.getElementById('uopOpsPct'), uopGrowthPct = document.getElementById('uopGrowthPct');
const uopProdAmt = document.getElementById('uopProdAmt'), uopOpsAmt = document.getElementById('uopOpsAmt'), uopGrowthAmt = document.getElementById('uopGrowthAmt');
const mA = document.getElementById('mA'), mB = document.getElementById('mB');
const regionNote = document.getElementById('regionNote');
const regionSel = document.getElementById('region');

/* ---------- Helpers ---------- */
const eur = n => new Intl.NumberFormat(LANG==='de'?'de-DE':LANG==='ro'?'ro-RO':'en-US',{style:'currency',currency:'EUR',maximumFractionDigits:0}).format(+n||0);
const pct = n => `${(Math.max(0,Math.min(100,+n||0))).toFixed(0)}%`;

function syncRanges(){
  uopProdNum.value = uopProd.value; uopOpsNum.value = uopOps.value; uopGrowthNum.value = uopGrowth.value;
  const total = +uopProd.value + +uopOps.value + +uopGrowth.value;
  uopTotal.textContent = total + '%';
  uopTotal.style.color = (total===100)?'#9fe6c3':'#ffd966';
}
[uopProd,uopOps,uopGrowth].forEach(el=> el.addEventListener('input', ()=>{ syncRanges(); calc(); }));
[uopProdNum,uopOpsNum,uopGrowthNum].forEach(el=> el.addEventListener('input', ()=>{
  const twin = ({uopProdNum:uopProd,uopOpsNum:uopOps,uopGrowthNum:uopGrowth})[el.id]; twin.value = el.value; syncRanges(); calc();
}));

function switchMode(){
  const isSub = revMode.value==='sub';
  subBlock.style.display = isSub?'grid':'none';
  oneBlock.style.display = isSub?'none':'grid';
  metricLabel.textContent = isSub ? (LANG==='de'?'MRR (€)':'MRR (€)') :
    (LANG==='de'?'30-Tage-GMV (€)': LANG==='ro'?'GMV 30 zile (€)':'30-Day GMV (€)');
  calc();
}
revMode.addEventListener('change', switchMode);

/* ---------- Core calc ---------- */
function calc(){
  // revenue
  let headline = 0;
  if(revMode.value==='sub'){
    mrr.value = (+subs.value||0) * (+avgPrice.value||0);
    headline = +mrr.value||0;
  }else{
    gmv.value = (+orders.value||0) * (+avgTicket.value||0);
    headline = +gmv.value||0;
  }
  metricValue.textContent = eur(headline);

  // paying
  kPayL30.textContent = +payingL30.value||0;
  kPayAll.textContent = +payingAll.value||0;

  // retention
  const coh = +cohort.value||0, ret = +retained.value||0;
  const r = coh>0 ? (ret/coh*100) : 0;
  retention.value = r.toFixed(1);
  kRet.textContent = `${retention.value}%`;

  // ticket size
  const ticket = (+burn.value||0) * (+runway.value||0) * (1 + (+buffer.value||0)/100);
  kTicket.textContent = eur(ticket);

  // UoP amounts
  const p = +uopProd.value||0, o=+uopOps.value||0, g=+uopGrowth.value||0, sum=p+o+g;
  const norm = sum>0? 1/sum : 0;
  const p2 = Math.round(p*norm*100), o2=Math.round(o*norm*100), g2=100 - p2 - o2;
  uopProdPct.textContent = p2+'%'; uopOpsPct.textContent = o2+'%'; uopGrowthPct.textContent = g2+'%';
  uopProdAmt.textContent = eur(ticket * p2/100);
  uopOpsAmt.textContent  = eur(ticket * o2/100);
  uopGrowthAmt.textContent= eur(ticket * g2/100);

  // milestones / region note
  mA.textContent = document.getElementById('mileA').value || '—';
  mB.textContent = document.getElementById('mileB').value || '—';
  regionNote.textContent = regionSel.value==='eu' ? 'EU (no US offering)' : 'Global (excl. restricted)';

  // chart
  updateChart(headline);
}

/* ---------- Chart ---------- */
let chart;
function updateChart(headline){
  const ctx = document.getElementById('chartRev').getContext('2d');
  const data = Array.from({length:12}, (_,i)=> Math.round(headline * (0.65 + i*0.03))); // simple slope
  if(!chart){
    chart = new Chart(ctx,{
      type:'line',
      data:{labels:[1,2,3,4,5,6,7,8,9,10,11,12],datasets:[{data,tension:.35}]},
      options:{responsive:true,maintainAspectRatio:false,plugins:{legend:{display:false},tooltip:{enabled:false}},elements:{point:{radius:0}}}
    });
  }else{
    chart.data.datasets[0].data = data;
    chart.update('none');
  }
}

/* ---------- Excel export ---------- */
document.getElementById('excelBtn').addEventListener('click', ()=>{
  const wsData = [
    ["Metric","Value"],
    [revMode.value==='sub'?'MRR (€)':'30-Day GMV (€)', (revMode.value==='sub'? mrr.value : gmv.value)],
    ["# Paying (L30D)", payingL30.value],
    ["# Paying (All-time)", payingAll.value],
    ["4-Week Retention %", retention.value],
    ["Monthly Burn (€)", burn.value],
    ["Runway (months)", runway.value],
    ["Buffer %", buffer.value],
    ["Target Ticket (€)", document.getElementById('kTicket').textContent.replace(/[^\d.,-]/g,'')],
    ["UoP Product %", document.getElementById('uopProdPct').textContent],
    ["UoP Compliance/Ops %", document.getElementById('uopOpsPct').textContent],
    ["UoP Growth %", document.getElementById('uopGrowthPct').textContent],
    ["UoP Product (€)", document.getElementById('uopProdAmt').textContent.replace(/[^\d.,-]/g,'')],
    ["UoP Compliance/Ops (€)", document.getElementById('uopOpsAmt').textContent.replace(/[^\d.,-]/g,'')],
    ["UoP Growth (€)", document.getElementById('uopGrowthAmt').textContent.replace(/[^\d.,-]/g,'')],
    ["Milestone A", document.getElementById('mileA').value],
    ["Milestone B", document.getElementById('mileB').value],
    ["Region", regionSel.value==='eu'?'EU (no US offering)':'Global (excl. restricted)'],
  ];
  const wb = XLSX.utils.book_new();
  const ws = XLSX.utils.aoa_to_sheet(wsData);
  XLSX.utils.book_append_sheet(wb, ws, "DIA10 Metrics");
  XLSX.writeFile(wb, "DIA10_metrics.xlsx");
});

/* ---------- Reset ---------- */
document.getElementById('resetBtn').addEventListener('click', ()=>{
  // simple resets
  ['subs','avgPrice','mrr','orders','avgTicket','gmv','payingL30','payingAll','cohort','retained','retention']
  .forEach(id=> document.getElementById(id).value = 0);
  burn.value = 18000; runway.value = 18; buffer.value = 10;
  uopProd.value = uopProdNum.value = 45; uopOps.value = uopOpsNum.value = 25; uopGrowth.value = uopGrowthNum.value = 30;
  document.getElementById('mileA').value = "Creator-Toolkit v1 + 100 paying members";
  document.getElementById('mileB').value = "500 verified certificates + wallet import";
  regionSel.value = 'eu';
  syncRanges(); calc();
});

/* ---------- Wire inputs ---------- */
['input','change'].forEach(evt=>{
  [subs,avgPrice,orders,avgTicket,payingL30,payingAll,cohort,retained,burn,runway,buffer,regionSel,
   document.getElementById('mileA'), document.getElementById('mileB')].forEach(el=> el.addEventListener(evt, calc));
});
syncRanges(); switchMode(); calc();
</script>
</body>
</html>

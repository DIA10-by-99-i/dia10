<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>DIAâ€‘10 Investorenâ€‘Zertifikat</title>
<link rel="icon" href="../images/99i_favicon_32x32.ico">
<script src="https://cdn.jsdelivr.net/npm/html2pdf.js@0.10.1/dist/html2pdf.bundle.min.js"></script>
<style>
  :root{
    --ink:#0A1E3F; --frame:#C0C0C0; --muted:#5d6a7a;
  }
  html,body{height:100%}
  body{
    margin:0; background:#f4f6f9; color:var(--ink);
    display:flex; align-items:center; justify-content:center;
    padding:40px 24px; font-family: Georgia, "Times New Roman", serif;
  }
  .stage{ width:min(920px,100%); display:grid; gap:22px; justify-items:center }

  .certificate{
    background:#fff; width:min(860px, 100%);
    padding:56px 64px; border:8px double var(--frame);
    box-shadow:0 18px 45px rgba(0,0,0,.18);
    border-radius:6px;
  }
  .brand{
    display:grid; justify-items:center; gap:8px; margin-bottom:6px;
  }
  .logo{ height:88px; display:block }
  h1{ font-size:30px; letter-spacing:.4px; margin:10px 0 2px }
  h2{ font-size:20px; font-weight:normal; color:#666; margin:0 0 10px }
  .number{ color:#8a8a8a; font-weight:700; margin:8px 0 18px }
  .lead{ color:#3c4654; margin:0 0 20px; text-align:center }
  .muted{ color:var(--muted) }

  .form{
    display:grid; gap:18px; margin:12px 0 8px;
  }
  .grid2{
    display:grid; grid-template-columns:1fr 1fr; gap:18px;
  }
  .field label{ display:block; font-weight:700; font-size:16px; margin-bottom:6px }
  .field input{
    width:100%; padding:12px 14px; font-size:16px;
    border:1px solid #cfd6de; border-radius:10px;
    font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
    background:#fbfcfe;
  }
  .note{ font-size:14px; color:#586476; margin-top:6px }
  .para{
    line-height:1.65; color:#273244; font-size:17px;
    margin-top:10px;
  }

  .sigrow{
    display:flex; align-items:flex-end; justify-content:space-between;
    gap:20px; margin-top:24px;
  }
  .sigbox{ display:grid; gap:6px }
  .sig{ height:54px; opacity:.95 }
  .sigcap{ font-size:14px; color:#415064 }

  .btn{
    background:#0A1E3F; color:#fff; border:none; border-radius:12px;
    padding:14px 20px; font-size:16px; cursor:pointer;
    box-shadow:0 10px 24px rgba(10,30,63,.25);
  }
  .btn:hover{ filter:brightness(1.06) }
  .center{ text-align:center }
</style>
</head>
<body>

<div class="stage">
  <div class="certificate" id="certificateContent">
    <div class="brand">
      <img id="logo" src="../images/dia_10.png" alt="DIAâ€‘10 Logo" class="logo">
    </div>

    <h1 class="center">INVESTORENâ€‘ZERTIFIKAT</h1>
    <h2 class="center">DIAâ€‘10 Beteiligung</h2>
    <div class="number center">
      Zertifikatsâ€‘Nr.: <span id="certNumber"></span> &nbsp;â€¢&nbsp;
      Datum: <span id="certDate"></span>
    </div>

    <p class="lead">
      Dieses Zertifikat bestÃ¤tigt den Erwerb von DIAâ€‘10â€‘Anteilen.<br>
      <span class="muted">This certificate confirms the acquisition of DIAâ€‘10 shares.</span>
    </p>

    <div class="form">
      <div class="grid2">
        <div class="field">
          <label for="investorName">Ihr Name</label>
          <input id="investorName" type="text" placeholder="Max Mustermann">
        </div>
        <div class="field">
          <label for="amount">Betrag (â‚¬)</label>
          <input id="amount" type="number" value="100" min="1" step="1" oninput="calcShares()">
          <div class="note">(Preis pro Anteil: 10 â‚¬) â€” Anteile: <b><span id="shares">10.00</span></b></div>
        </div>
      </div>

      <div class="para">
        <b>Aussteller:</b> Markus Goffin â€“ MAGO SERVICE TRADE SRL<br>
        Aleea Textilistilor Nr.â€¯1 â€“ BL.â€¯MY1, Sc.â€¯1, App.â€¯16, Sectorulâ€¯3, 032801 BucureÈ™ti, Romania<br>
        Handelsregister: J40/5941/2015 &nbsp;|&nbsp; CUIâ€“34523632<br><br>
        <b>Kontakt:</b> +40 (0)752 30 77 11 &nbsp;|&nbsp; mgoffin@web.de &nbsp;|&nbsp; https://99-i.com/<br>
        <b>Bank:</b> BRD â€“ Bukarest &nbsp;|&nbsp; IBAN: RO34BRDE426SV66680914260 &nbsp;|&nbsp; BIC: BRDEROBU
      </div>

      <div class="sigrow">
        <div class="sigbox">
          <img id="sig" class="sig" src="../images/signature_markus.png" alt="Unterschrift Markus Goffin">
          <div class="sigcap">Markus Goffin, Herausgeber</div>
        </div>
        <div class="note" style="max-width:420px">
          <em>Das Zertifikat ist einzigartig und wird nach Zahlungseingang gÃ¼ltig.
          Bitte die Zertifikatsâ€‘Nr. im Verwendungszweck angeben und die PDFâ€‘Datei sorgfÃ¤ltig aufbewahren.</em>
        </div>
      </div>
    </div>
  </div>

  <button id="btnCreate" class="btn">ðŸ“„ Zertifikat als PDF herunterladen</button>
</div>

<script>
  // Lange, fortlaufende Zertifikatsnummer + Datum
  const CERT_NO = Date.now();
  document.getElementById('certNumber').textContent = CERT_NO;
  document.getElementById('certDate').textContent =
    new Intl.DateTimeFormat('de-DE',{day:'2-digit',month:'2-digit',year:'numeric'}).format(new Date());

  function calcShares(){
    const v = parseFloat(document.getElementById('amount').value || '0');
    document.getElementById('shares').textContent = (v/10).toFixed(2);
  }
  calcShares();

  // Hilfsfunktion: Bild in Dataâ€‘URL umwandeln (verhindert CORSâ€‘Probleme)
  async function imgToDataURL(imgEl){
    try{
      const src = imgEl.getAttribute('src');
      if(!src) return false;
      const res = await fetch(src, {cache:'no-store'});
      if(!res.ok) throw new Error('fetch failed');
      const blob = await res.blob();
      const dataUrl = await new Promise(r=>{
        const fr = new FileReader();
        fr.onload = () => r(fr.result);
        fr.readAsDataURL(blob);
      });
      imgEl.src = dataUrl;
      return true;
    }catch(e){
      // Bild ausblenden, wenn nicht ladbar
      imgEl.style.display = 'none';
      return false;
    }
  }

  async function prepareImages(){
    const logo = document.getElementById('logo');
    const sig  = document.getElementById('sig');
    await Promise.all([imgToDataURL(logo), imgToDataURL(sig)]);
  }

  async function downloadPDF(){
    const node = document.getElementById('certificateContent');
    await prepareImages();

    const opt = {
      margin:       [12,12,12,12],
      filename:     `DIA10-Zertifikat-${CERT_NO}.pdf`,
      image:        { type:'jpeg', quality:0.98 },
      html2canvas:  { scale:2, useCORS:true, allowTaint:true, backgroundColor:'#ffffff' },
      jsPDF:        { unit:'pt', format:'a4', orientation:'portrait' }
    };

    // sanfte Scrollâ€‘Korrektur (verhindert gelegentliche Clippingâ€‘Artefakte)
    const prevScrollY = window.scrollY;
    window.scrollTo(0,0);

    try{
      await html2pdf().set(opt).from(node).save();
    }finally{
      window.scrollTo(0, prevScrollY);
    }
  }

  document.getElementById('btnCreate').addEventListener('click', async ()=>{
    const name = (document.getElementById('investorName').value||'').trim();
    if(!name){ alert('Bitte Ihren Namen eingeben.'); return; }
    try{
      await downloadPDF();
    }catch(err){
      console.error(err);
      alert('PDFâ€‘Erstellung fehlgeschlagen. Versuche es bitte erneut.');
    }
  });
</script>
</body>
</html>
